# API 管理平台功能需求清单

> 基于 Apifox 功能特性，结合 YAPI 数据同步的 API 调试、测试、文档一体化协作平台

---

## 一、核心定位

**目标**：构建一个集 API 调试、测试、文档于一体的协作平台

**核心特点**：
- **接口数据来源**：仅支持 YAPI Webhook 推送同步，不支持手动配置
- **调试能力**：基于同步的接口数据进行调试
- **测试能力**：基于同步的接口数据创建测试用例
- **文档能力**：自动生成在线 API 文档

---

## 二、功能模块分层

### 🔷 第一层：YAPI 数据同步层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **Webhook 接收** | 接收 YAPI 推送的接口变更数据 | P0 |
| **数据解析** | 解析 YAPI 接口数据格式（接口信息、路径参数、查询参数、请求体、响应） | P0 |
| **接口同步** | 新增接口、更新接口、删除接口同步 | P0 |
| **分类同步** | 接口分类/项目分组同步 | P0 |
| **同步日志** | 记录同步成功/失败状态、错误信息 | P0 |
| **同步状态展示** | 显示最后同步时间、同步状态、差异对比 | P1 |
| **手动触发同步** | 支持手动从 YAPI 拉取全量数据 | P1 |

### 🔷 第二层：API 调试层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **接口列表** | 展示从 YAPI 同步的接口列表（按分类分组） | P0 |
| **接口详情** | 显示接口定义（从同步数据读取） | P0 |
| **请求发送** | 基于同步的接口定义发送请求 | P0 |
| **环境管理** | 多环境切换、环境变量、全局变量 | P0 |
| **前置/后置脚本** | 请求前预处理、响应后处理 | P1 |
| **Cookie 管理** | 自动 Cookie 持久化 | P1 |
| **请求历史** | 历史请求记录、快捷复用 | P1 |
| **收藏功能** | 收藏常用接口（本地存储） | P1 |

### 🔷 第三层：API 测试层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **测试用例** | 基于同步的接口创建测试用例 | P0 |
| **测试套件** | 用例集合、批量执行 | P0 |
| **断言验证** | 状态码、响应体、响应头、响应时间断言 | P0 |
| **数据驱动** | 参数化测试、多组数据测试 | P1 |
| **测试报告** | 执行结果、通过率、详细日志 | P1 |
| **性能测试** | 压力测试、并发测试 | P2 |

### 🔷 第四层：Mock 服务层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **Mock 规则** | 根据同步的接口 Schema 自动生成 Mock 数据 | P0 |
| **自定义 Mock** | 针对接口自定义 Mock 模板、脚本 | P1 |
| **Mock 期望** | 根据请求参数返回不同数据 | P1 |
| **Mock 服务** | 公网/内网 Mock 地址 | P0 |

### 🔷 第五层：文档层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **在线文档** | 基于同步数据自动生成 API 文档页面 | P0 |
| **文档分享** | 公开/私有链接、权限控制 | P0 |
| **文档导出** | Markdown/HTML/Word/PDF | P1 |
| **文档搜索** | 全文搜索、快速定位 | P1 |
| **代码示例** | 多语言请求代码生成 | P1 |

### 🔷 第六层：AI 辅助层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **AI 生成用例** | 根据接口定义自动生成测试用例 | P1 |
| **AI 生成数据** | 根据用例自动生成测试数据 | P1 |
| **AI 参数命名** | 智能参数命名建议 | P2 |
| **AI 规范检测** | 接口文档完整性检测、规范建议 | P1 |

### 🔷 第七层：团队协作层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **成员管理** | 邀请成员、角色权限（Owner/Admin/Editor/Viewer） | P0 |
| **操作日志** | 操作记录审计、变更追溯 | P1 |
| **评论与讨论** | 接口评论、@提醒 | P2 |

### 🔷 第八层：用户与项目管理层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **用户认证** | 登录/注册/Token 认证 | P0 |
| **项目管理** | 创建项目（绑定 YAPI 项目）、项目成员 | P0 |
| **YAPI 配置** | 配置 YAPI 地址、Token、Webhook 密钥 | P0 |
| **个人中心** | 个人信息、API Token 管理 | P1 |

### 🔷 第九层：系统设置层

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| **主题设置** | 亮色/暗色主题、自定义主题色 | P2 |
| **界面布局** | 自定义工作区布局 | P2 |
| **快捷键** | 自定义快捷键 | P2 |

---

## 三、YAPI 数据格式说明

### Webhook 推送事件类型

| 事件类型 | 说明 |
|----------|------|
| `interface.add` | 新增接口 |
| `interface.update` | 更新接口 |
| `interface.delete` | 删除接口 |
| `project.update` | 项目更新 |

### 接口数据结构（需解析）

```
{
  "type": "interface.update",
  "data": {
    "id": 接口ID,
    "name": 接口名称,
    "path": 接口路径,
    "method": 请求方法,
    "title": 接口标题,
    "status": 接口状态,
    "req_params": 路径参数,
    "req_query": 查询参数,
    "req_headers": 请求头,
    "req_body_type": 请求体类型,
    "req_body_other": 请求体定义,
    "res_body": 响应体定义,
    "catid": 分类ID
  }
}
```

---

## 四、技术架构建议

```
┌─────────────────────────────────────────────────────────────────┐
│                           前端层                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ API 调试 │  │ API 测试 │  │  Mock   │  │  文档   │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
├─────────────────────────────────────────────────────────────────┤
│                           后端层                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │Webhook接收│ │ 同步处理 │  │ 测试引擎 │  │ Mock服务│         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              YAPI 数据格式解析器                         │    │
│  └─────────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────┤
│                           数据层                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │ 用户/权限 │  │ 接口数据 │  │ 测试数据 │  │ 同步日志 │         │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────────────────┘
                              ↑
                              │ Webhook
                              │
                    ┌─────────┴─────────┐
                    │      YAPI 系统     │
                    └───────────────────┘
```

---

## 五、开发优先级建议

| 阶段 | 核心功能 | 目标 |
|------|----------|------|
| **MVP** | YAPI Webhook 接收、接口同步、请求调试、在线文档 | 基础可用 |
| **V1.0** | 测试用例、环境管理、团队协作、Mock 服务 | 团队使用 |
| **V2.0** | AI 辅助、高级测试、性能测试 | 智能升级 |

---

## 六、参考资源

- [Apifox 官方网站](https://apifox.com)
- [Apifox 功能更新博客](https://apifox.com/blog/)
- [YAPI 官方文档](https://hellosean1025.github.io/yapi/)
- [OpenAPI 规范](https://spec.openapis.org/oas/latest.html)
